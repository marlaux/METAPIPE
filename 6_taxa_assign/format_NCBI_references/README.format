DOWNLOADING REFERENCES:
Download your references directly from NCBI taxonomy page or using the Entrez efetch system. 
./EntrezDirect.sh -h

The genbank sequence header format is like this:
>MW621368.1 Chydorus sphaericus complex sp. Ch129_Vietnam cytochrome c oxidase subunit I (COX1) gene, partial cds; mitochondrial
AGCGGGTACAGGTTGAACTGTTTACCCACCTTTATCGGCTGGAATCGCTCATTCAGGAGCTTCAGTTGATAGCGGGTACAGGTTGAACTGTTTACCCACCTTTATCGGCTGGAATCGCTCATTCAGGAGCTTCAGTTGAT

But what we need is:
>AB812619.1 Eukaryota|Arthropoda|Insecta|Coleoptera|Curculionidae|Xyleborus|Xyleborus+defensus
AACTTTATATTTTATCTTTGGGGCTTGAGCAGGAATAGTGGGAACTTCCTTAAGTGTATT

The format_NCBI2lineages_auto.sh script does it for us.
Usage:
./format_NCBI2lineages_auto.sh -r references_downloaded.fasta -p prefix2output
For more details use help flag:
./format_NCBI2lineages_auto.sh -h

Download and install TaxonKit:
wget https://github.com/shenwei356/taxonkit/releases/download/v0.8.0/taxonkit_linux_amd64.tar.gz
tar -zxvf taxonkit_linux_amd64.tar.gz
mkdir -p $HOME/bin/; cp taxonkit $HOME/bin/
taxonkit -> https://bioinf.shenwei.me/taxonkit/tutorial/

be sure that you have the following files in your directory:
references_downloaded.fasta -> from browser or EntrezDirect.sh
edit_lineage.pl || edit_lineage_auto.pl
remove_dups.pl || remove_dups_auto.pl
nucl_gb.accession2taxid.gz -> wget ftp://ftp.ncbi.nlm.nih.gov/pub/taxonomy/accession2taxid/nucl_gb.accession2taxid.gz
taxdb.btd and taxdb.bti: ftp://ftp.ncbi.nlm.nih.gov/blast/db/taxdb.tar.gz
tar -xvf taxdb.tar.gz


The format_NCBI2lineages_flags.sh options works the same way, but keeping all intermediary files stored in format_out directory.
