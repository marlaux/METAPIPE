DOWNLOADING REFERENCES:
Download your references directly from NCBI taxonomy page or using the Entrez efetch system. 
./EntrezDirect.sh -h

The genbank sequence header format is like this:
>MW621368.1 Chydorus sphaericus complex sp. Ch129_Vietnam cytochrome c oxidase subunit I (COX1) gene, partial cds; mitochondrial
AGCGGGTACAGGTTGAACTGTTTACCCACCTTTATCGGCTGGAATCGCTCATTCAGGAGCTTCAGTTGATAGCGGGTACAGGTTGAACTGTTTACCCACCTTTATCGGCTGGAATCGCTCATTCAGGAGCTTCAGTTGAT

But what we need is:
>AB812619.1 Eukaryota|Arthropoda|Insecta|Coleoptera|Curculionidae|Xyleborus|Xyleborus+defensus
AACTTTATATTTTATCTTTGGGGCTTGAGCAGGAATAGTGGGAACTTCCTTAAGTGTATT

The format_NCBI2lineages_auto.sh script does it for us.
Usage:
./format_NCBI2lineages_auto.sh -r references_downloaded.fasta -p prefix2output
For more details use help flag:
The format_NCBI2lineages_auto.sh -h

be sure that you have the following files in your directory:
edit_lineage.pl
remove_dups.pl 
nucl_gb.accession2taxid.gz
taxonkit
references_downloaded.fasta

The format_NCBI2lineages_flags.sh options works the same way, but keeping all intermediary files stored in format_out directory.
